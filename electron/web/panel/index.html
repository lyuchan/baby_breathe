<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="./panel.js"></script>

    <title>安心小助手</title>
</head>

<body>
    <nav class="topnav">
        安心小助手
        <div class="navbutton">
            <button class="btn settings-btn" onclick='tosettings();'>
                <svg version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20"
                    style="enable-background:new 0 0 20 20;" xml:space="preserve">
                    <style type="text/css">
                        .st0 {
                            fill: #FFFFFF;
                        }
                    </style>
                    <path class="st0" d="M0,14.02c0.05-0.25,0.1-0.51,0.15-0.76c0.23-0.97,0.69-1.8,1.38-2.51C2.56,9.7,3.59,8.65,4.62,7.6
	c0.04-0.04,0.08-0.07,0.16-0.14c-0.03,0.22-0.05,0.4-0.07,0.58c-0.1,0.98-0.02,1.95,0.26,2.89c0.05,0.18,0.02,0.32-0.11,0.46
	c-0.51,0.51-1.02,1.03-1.51,1.56c-0.85,0.92-0.9,2.33-0.14,3.32c0.92,1.2,2.71,1.38,3.8,0.32c1.24-1.22,2.44-2.48,3.63-3.74
	c0.48-0.51,0.77-1.12,0.73-1.85c-0.04-0.91-0.46-1.59-1.2-2.09c-0.3-0.21-0.32-0.24-0.15-0.56c0.33-0.62,0.79-1.12,1.33-1.57
	c0.14-0.12,0.28-0.12,0.43-0.01c1.23,0.89,2,2.08,2.24,3.59c0.19,1.24,0.02,2.44-0.63,3.52c-0.31,0.51-0.71,0.98-1.13,1.42
	c-1.02,1.08-2.06,2.14-3.12,3.18c-0.95,0.94-2.1,1.43-3.44,1.52C5.63,19.97,5.55,19.99,5.47,20c-0.04,0-0.08,0-0.12,0
	c-0.24-0.02-0.48-0.04-0.72-0.08c-2.2-0.3-3.97-1.89-4.48-4.05c-0.06-0.25-0.1-0.5-0.16-0.76C0,14.75,0,14.39,0,14.02z" />
                    <path class="st0" d="M20,5.94c-0.06,0.29-0.1,0.59-0.17,0.88c-0.24,0.94-0.71,1.75-1.39,2.45c-1.03,1.06-2.07,2.11-3.1,3.17
	c-0.03,0.04-0.07,0.07-0.14,0.13c0.03-0.31,0.07-0.59,0.09-0.86c0.08-0.88-0.01-1.75-0.27-2.6c-0.06-0.2-0.03-0.34,0.12-0.49
	c0.48-0.48,0.96-0.97,1.43-1.47c1.4-1.46,0.71-3.86-1.26-4.33c-0.93-0.22-1.75,0.03-2.43,0.71c-0.82,0.83-1.64,1.66-2.45,2.5
	c-0.41,0.42-0.81,0.84-1.2,1.28c-1.1,1.25-0.67,3.08,0.65,3.88c0.22,0.13,0.24,0.22,0.1,0.44c-0.38,0.6-0.85,1.13-1.36,1.63
	c-0.14,0.13-0.26,0.14-0.41,0.03c-1.22-0.86-1.95-2.04-2.2-3.5C5.7,8.1,6.09,6.58,7.19,5.29C7.66,4.73,8.19,4.23,8.7,3.71
	c0.7-0.72,1.39-1.44,2.11-2.14c0.95-0.93,2.1-1.44,3.43-1.53c0.08-0.01,0.17-0.02,0.25-0.03c0.07,0,0.13,0,0.2,0
	c0.22,0.02,0.44,0.05,0.66,0.07c2.15,0.29,3.9,1.83,4.46,3.94c0.08,0.3,0.13,0.61,0.19,0.91C20,5.26,20,5.6,20,5.94z" />
                </svg>
            </button>
            <button class="btn logout-btn" onclick='logout();'>
                <svg fill="#FFFFFF" height="20" width="20" viewBox="0 0 490.3 490.3">
                    <path d="M0,121.05v248.2c0,34.2,27.9,62.1,62.1,62.1h200.6c34.2,0,62.1-27.9,62.1-62.1v-40.2c0-6.8-5.5-12.3-12.3-12.3
                    s-12.3,5.5-12.3,12.3v40.2c0,20.7-16.9,37.6-37.6,37.6H62.1c-20.7,0-37.6-16.9-37.6-37.6v-248.2c0-20.7,16.9-37.6,37.6-37.6h200.6
                    c20.7,0,37.6,16.9,37.6,37.6v40.2c0,6.8,5.5,12.3,12.3,12.3s12.3-5.5,12.3-12.3v-40.2c0-34.2-27.9-62.1-62.1-62.1H62.1
                    C27.9,58.95,0,86.75,0,121.05z" />
                    <path d="M385.4,337.65c2.4,2.4,5.5,3.6,8.7,3.6s6.3-1.2,8.7-3.6l83.9-83.9c4.8-4.8,4.8-12.5,0-17.3l-83.9-83.9
                    c-4.8-4.8-12.5-4.8-17.3,0s-4.8,12.5,0,17.3l63,63H218.6c-6.8,0-12.3,5.5-12.3,12.3c0,6.8,5.5,12.3,12.3,12.3h229.8l-63,63
                    C380.6,325.15,380.6,332.95,385.4,337.65z" />
                </svg>
            </button>

        </div>
    </nav>
    <div class=" panel-main">
        <div class="panel-row">

            <p class="text" style="color:black;">我不想寫css<br>我不想寫css</p>
            <!--
            <input id="atemip" class="atemip textbox" type="text" placeholder="ex:192.168.0.255(廣播位置)">
            <button class="btn connect-btn" onclick="atemip();">
                <svg width="20px" height="20px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M10.5004 11.9998H5.00043M4.91577 12.2913L2.58085 19.266C2.39742 19.8139 2.3057 20.0879 2.37152 20.2566C2.42868 20.4031 2.55144 20.5142 2.70292 20.5565C2.87736 20.6052 3.14083 20.4866 3.66776 20.2495L20.3792 12.7293C20.8936 12.4979 21.1507 12.3822 21.2302 12.2214C21.2993 12.0817 21.2993 11.9179 21.2302 11.7782C21.1507 11.6174 20.8936 11.5017 20.3792 11.2703L3.66193 3.74751C3.13659 3.51111 2.87392 3.39291 2.69966 3.4414C2.54832 3.48351 2.42556 3.59429 2.36821 3.74054C2.30216 3.90893 2.3929 4.18231 2.57437 4.72906L4.91642 11.7853C4.94759 11.8792 4.96317 11.9262 4.96933 11.9742C4.97479 12.0168 4.97473 12.0599 4.96916 12.1025C4.96289 12.1506 4.94718 12.1975 4.91577 12.2913Z"
                        stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </button>
            <button class="btn reload-btn" onclick="reloadTally();">
                <svg fill="#FFFFFF" height="20px" width="20px" viewBox="0 0 489.645 489.645">
                    <path d="M460.656,132.911c-58.7-122.1-212.2-166.5-331.8-104.1c-9.4,5.2-13.5,16.6-8.3,27c5.2,9.4,16.6,13.5,27,8.3
            c99.9-52,227.4-14.9,276.7,86.3c65.4,134.3-19,236.7-87.4,274.6c-93.1,51.7-211.2,17.4-267.6-70.7l69.3,14.5
            c10.4,2.1,21.8-4.2,23.9-15.6c2.1-10.4-4.2-21.8-15.6-23.9l-122.8-25c-20.6-2-25,16.6-23.9,22.9l15.6,123.8
            c1,10.4,9.4,17.7,19.8,17.7c12.8,0,20.8-12.5,19.8-23.9l-6-50.5c57.4,70.8,170.3,131.2,307.4,68.2
            C414.856,432.511,548.256,314.811,460.656,132.911z" />
                </svg>
            </button>
-->
        </div>

        <div class="tb">
            <table id="control">
                <tr>
                    <th>姓名</th>
                    <th>裝置ID</th>
                    <th>連線狀態</th>
                    <th>功能</th>
                </tr>
                <tbody id="table-list">
                    <!-- list -->
                </tbody>
            </table>
        </div>
    </div>
</body>

<script type="text/html" id="col-template">
    <tr>
        <td>{{name}}</td>
        <td>{{deviceid}}</td>
        <td>{{ii}}</td>
        <td>
            <button class="btn btn-ctrlfind" onclick="settingdevice('{{deviceid}}')">設定</button>
            <button class="btn btn-ctrlfind" onclick="showinfo('{{deviceid}}')">查看</button>
        </td>
    </tr>
</script>

<script>


    $.ajax({
        "url": "https://db.lyuchan.com/user_device_list?user_id=U8888abcabcbac69dd8a7b580f1d433e0",
        "method": "GET",
        "timeout": 0,
    }).done(function (response) {
        $('#table-list').empty();

        for (let i = 0; i < response.data.length; i++) {
            let sping = ''
            let cping = ''
            if (((new Date() - new Date(response.data[i].ping)) / 1000) > 10) {
                sping = "感測器斷線 🔴\n"
            } else {
                sping = "感測器在線 🟢\n"
            }
            if (((new Date() - new Date(response.data[i].cam_ping)) / 1000) > 10) {
                cping = "攝影機斷線 🔴"
            } else {
                cping = "攝影機在線 🟢"
            }
            let template = $('#col-template').text();
            template = template.replace(/{{deviceid}}/g, `${response.data[i].device}`).replace(/{{name}}/g, `${response.data[i].name}`).replace(/{{ii}}/g, `${sping}<br>${cping}`);
            $('#table-list').append(template);
        }
    });


    setInterval(() => {
        {

            $.ajax({
                "url": "https://db.lyuchan.com/user_device_list?user_id=U8888abcabcbac69dd8a7b580f1d433e0",
                "method": "GET",
                "timeout": 0,
            }).done(function (response) {
                $('#table-list').empty();

                for (let i = 0; i < response.data.length; i++) {
                    let sping = ''
                    let cping = ''
                    if (((new Date() - new Date(response.data[i].ping)) / 1000) > 10) {
                        sping = "感測器斷線 🔴\n"
                    } else {
                        sping = "感測器在線 🟢\n"
                    }
                    if (((new Date() - new Date(response.data[i].cam_ping)) / 1000) > 10) {
                        cping = "攝影機斷線 🔴"
                    } else {
                        cping = "攝影機在線 🟢"
                    }
                    let template = $('#col-template').text();
                    template = template.replace(/{{deviceid}}/g, `${response.data[i].device}`).replace(/{{name}}/g, `${response.data[i].name}`).replace(/{{ii}}/g, `${sping}<br>${cping}`);
                    $('#table-list').append(template);
                }
            });

        }
    }, 2500);

</script>

</html>